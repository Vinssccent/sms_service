# SMS Service

Сервис управления SMS-активациями использует централизованный модуль `src/settings.py` для
загрузки конфигурации из переменных окружения или файла `.env`.  Настройки приводятся к
указанным типам с помощью `pydantic-settings`, поэтому значения можно задавать как строками,
так и через файлы переменных.

## Новые параметры конфигурации

Ниже перечислены дополнительные переменные окружения, которые теперь поддерживаются
напрямую через `Settings`.  Если переменная не задана, будет использовано значение по
умолчанию.

> **Примечание.** Булевы параметры принимают значения `1/0`, `true/false`, `yes/no` (без
> учета регистра).

### Ротация номеров и лимиты

| Переменная | Тип | Значение по умолчанию | Назначение |
| --- | --- | --- | --- |
| `NUMBER_COOLDOWN_MINUTES` | int | `5` | Время кулдауна в минутах перед повторной выдачей номера после завершения активации. |
| `ALLOW_COOLDOWN_FALLBACK` | bool | `true` | Разрешает единичный возврат номера из кулдауна, если все кандидаты заблокированы только им. |
| `CANDIDATE_ATTEMPTS` | int | `30` | Количество попыток выбрать подходящий номер из пула кандидатов, прежде чем вернуть ошибку. |
| `PROVIDER_SAMPLE_SIZE` | int | `8` | Число провайдеров, которые берутся в текущую выборку при ротации номеров. |
| `BOUNDS_CACHE_TTL` | int | `600` | Сколько секунд хранить в Redis границы (минимальный/максимальный ID) доступных номеров. |
| `STRICT_LIMITS` | bool | `true` | Жестко соблюдать лимиты выдачи номеров, даже если требуется перейти на подсчет через БД при сбоях Redis. |
| `PRIME_LIMIT_TTL` | int | `15` | Время жизни (в секундах) прогретых лимитов в Redis. |
| `INCR_LIMITS_ON_SUCCESS` | bool | `false` | При `true` успешная активация (`setStatus=6`) увеличивает Redis-счетчики лимитов. |

### Redis

| Переменная | Тип | Значение по умолчанию | Назначение |
| --- | --- | --- | --- |
| `REDIS_HOST` | str | `127.0.0.1` | Хост Redis, используемый для кешей и лимитов. |
| `REDIS_PORT` | int | `6379` | Порт подключения к Redis. |

### Сеансы и админка

| Переменная | Тип | Значение по умолчанию | Назначение |
| --- | --- | --- | --- |
| `SESSION_SECRET` | str | `CHANGE_ME_NOW__32+chars` | Ключ подписи cookie сессий Starlette/FastAPI. |
| `ADMIN_USER` | str | `admin` | Логин для входа в административную панель. |
| `ADMIN_PASS` | str | `super-secret` | Пароль для входа в административную панель. |

Более подробный перечень доступных параметров и их применение можно посмотреть в файле
[`src/settings.py`](src/settings.py).
